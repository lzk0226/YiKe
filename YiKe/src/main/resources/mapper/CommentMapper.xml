<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ruoyi.yike.mapper.CommentMapper">

    <!-- 查询所有评论 -->
    <select id="selectAllComments" resultType="com.ruoyi.yike.domain.Comment">
        SELECT id, note_id AS noteId, user_id AS userId, parent_id AS parentId,
               content, likes
        FROM comments
    </select>

    <!-- 根据笔记ID查询评论列表 -->
    <select id="selectCommentsByNoteId" resultType="com.ruoyi.yike.domain.Comment">
        SELECT id, note_id AS noteId, user_id AS userId, parent_id AS parentId,
               content, likes
        FROM comments
        WHERE note_id = #{noteId}
        ORDER BY id ASC
    </select>

    <!-- 根据ID查询单条评论 -->
    <select id="selectCommentById" resultType="com.ruoyi.yike.domain.Comment">
        SELECT id, note_id AS noteId, user_id AS userId, parent_id AS parentId,
               content, likes
        FROM comments
        WHERE id = #{id}
    </select>

    <!-- 新增评论 -->
    <insert id="insertComment" parameterType="com.ruoyi.yike.domain.Comment" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO comments (note_id, user_id, parent_id, content, likes)
        VALUES (#{noteId}, #{userId}, #{parentId}, #{content}, #{likes})
    </insert>

    <!-- 更新评论点赞数 -->
    <update id="updateCommentLikes">
        UPDATE comments
        SET likes = #{likes}
        WHERE id = #{id}
    </update>

</mapper>
